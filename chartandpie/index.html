<!DOCTYPE html>
<meta charset="utf-8">
<title>PODCAST</title>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
<script src="https://code.jquery.com/jquery.js"></script>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="https://raw.githubusercontent.com/pyrsmk/W/master/W.min.js"></script>
<script type="text/javascript" src="./exBOTH.js"></script>

</meta>
<style>
    
/*body{
    width:1200px;
    margin:10px;
}*/

.figcontainer{
overflow:auto;
}

/*#idhG{
  background-color:grey;
}

#idP{
  background-color:#ffcc00;

}

#idT{
  background-color:#ffcc00;
}*/

#Comment{font-size:12px; text-align:right;}

.row.a {background-color:grey;}

.row.b {background-color:#ffcc00;}

path {  stroke: #fff; }

path:hover {  opacity:0.9; }

/*rect {fill:steelblue; }*/

rect:hover {  fill:blue; }

.x-axis-group {
  font: 10px sans-serif;
}

.y-axis-group {
  font: 10px sans-serif;
}

.legend tr{    border-bottom:1px solid grey; }

.legend tr:first-child{    border-top:1px solid grey; }

.axis path,
.axis line {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}

.x.axis path {  display: none; }

.legend{
    margin-top: 10px;
    padding:12px;
    margin-left: 35px;
    display:inline-block;
    border-collapse: collapse;
    border-spacing: 0px;
}

.legend td{
    padding:4px 5px;
    vertical-align:bottom;
}

.legendFreq, .legendPerc{
    align:right;
    width:50px;
}

.barvalue{
  font-size: 10;
}

</style>

</meta>
<body>
<div id='dashboard'>


<div class="container figcontainer">
<div class="row a">
<div class="col-xl-4 col-lg-4 col-md-5 figs" id="idhG"></div>
<!--</div>-->
<!--<div class="row b">-->
<div class="col-xl-4 col-lg-4 col-md-4 col-sm-12 col-xs-12 figs" id="idT"></div>
<div class="col-xl-4 col-lg-4 col-md-3 col-sm-12 col-xs-12 figs" id="Comment"><p>In general, respondents suggested as useful <b>Codenewbie, JSJabber and Changelog</b>.<br>They differed in their individual preference according to time programming though.</br></p></div>
</div>
<div class="row a">
<div class="col-xl-12 col-lg-12 col-md-6 hidden-xs" style="margin-left:60%;" id="idP"></div>
</div>
</div>

</div>

<!--<div id='dashboard'>


<div class="container figcontainer">
<div class="row">
<div class="col-lg-7 figs" id="idhG">
</div>
<div class="col-lg-5 figs">
<div class="row">
<div class="col-md-12" id="idT">
</div>
</div>
<div class="row">
<div class="col-md-12 hidden-xs" id="idP">
</div>
</div>
</div>
</div>
</div>-->

</body>
<script>

var freqData=[
  {Podcast: 'CNewb', Name: 'CodeNewbie', freq:{low: 0.2302,mid: 0.191,high: 0.1367}},
  {Podcast: 'JSJbb', Name: 'JSJabber', freq:{low: 0.1787,mid: 0.1843,high: 0.1511}},
  {Podcast: 'ChLog', Name: 'Changelog', freq:{low: 0.0893,mid: 0.0831,high: 0.1367}},
  {Podcast: 'STalk', Name: 'ShopTalk', freq:{low: 0.0619,mid: 0.1169,high: 0.0647}},
  {Podcast: 'RRogs', Name: 'RubyRogues', freq:{low: 0.0893,mid: 0.0921,high: 0.0719}},
  {Podcast: 'DvTea', Name: 'DeveloperTea', freq:{low: 0.0997,mid: 0.0854,high: 0.0647}},
  {Podcast: 'SEDay', Name:'SoftwareEngineerDaily', freq:{low: 0.0447,mid: 0.0629,high: 0.1079}},
  {Podcast: 'TPyth', Name: 'TalkMePython', freq:{low: 0.0722,mid: 0.0382,high: 0.0216}},
  {Podcast: 'PTDwn', Name: 'ProgrammingThrowDown', freq:{low: 0.0515,mid: 0.0382,high: 0.0144}},
  {Podcast: 'JSAir', Name: 'JSAir', freq:{low: 0.0137,mid: 0.0382,high: 0.0504}},
  {Podcast: 'Hlmin', Name: 'Hanselminutes', freq:{low: 0.0069,mid: 0.018,high: 0.0647}},
  {Podcast: 'DNRck', Name: 'DotNetRocks', freq:{low: 0.0069,mid: 0.0135,high: 0.0719}},
  {Podcast: 'CBlck', Name: 'CodingBlocks', freq:{low: 0.0241,mid: 0.0157,high: 0.0072}},
  {Podcast: 'WbAhd', Name: 'WebAhead', freq:{low: 0.0103,mid: 0.018,high: 0.0216}}
];

freqData.forEach(function(d){d.total=d.freq.low+d.freq.mid+d.freq.high;});
var total=[];
freqData.forEach(function(d){total.push(d.total)})
var sum = total.reduce(function(a, b) { return a + b; }, 0);

function segColor(c){ return {low:"#807dba", mid:"#e08214",high:"#41ab5d"}[c]; }


// calculate total frequency by segment for all state.
var tF = ['low','mid','high'].map(function(d){
	return {Podcast: 'All', type:d, freq: d3.sum(freqData.map(function(t){ return t.freq[d];}))};
});

// calculate total frequency by state for all segment.
var sF = freqData.map(function(d){return [d.Podcast,d.total/sum,d.Name];});

var idhG = "#idhG";
var idP = "#idP";
var idT = "#idT";


function randomDatasetEX() {
  return freqData.map(function(d){d.total = ~~(Math.random() * 1000); return [d.Podcast,d.total];})
};

function randomDatasetBAR() {
  return freqData.map(function(d){d.total = ~~(Math.random() * 1000); return d.total;})
};

function randomDatasetPIE() {
  return tF.map(function(d){d.freq = ~~(Math.random() * 1000); return {type:d.type, freq: d.freq};})
};


function updateWidth() {
    //var width;
    if ($(window).width() > 500) {
      width = 600;
    }else{
      width = $(window).width() - .10*$(window).width();
    }
    console.log(width);
    return width
}

function initEvent(x){
  W.addListener(x);
}

//var w = updateWidth();


//////////////////////////////////
// Usage ex40.js
/////////////////////////////////

var chart = d3.custom.barChart();

//chart.width(updateWidth())
////chart.update_test();


function updateBAR(data, color) {
   if (!arguments.length) {data = randomDatasetBAR(); return data};
   if (color == undefined) {
       color = "steelblue";
   }

    
    d3.select(idhG)
        .datum(data)
        .call(chart.color(color));
        //.call(chart.color(color).width(updateWidth()));

}



//////////////////////////////////
// Usage ex41.js
/////////////////////////////////

var pie = d3.custom.pieChart();

function updatePIE(data) {
    if (!arguments.length) {data = randomDatasetPIE(); return data};
    //console.log(data)
    d3.select(idP)
        .datum(data)
        .call(pie);
}


//////////////////////////////////
// Usage ex42.js
/////////////////////////////////

var leg = d3.custom.legTable();

function updateLEG(data) {
    if (!arguments.length) {data = randomDatasetPIE(); return data};
    //console.log(data)
    d3.select(idT)
        .datum(data)
        .call(leg);
}


//////////////////////////////////
// Hovering functionalities
/////////////////////////////////

chart
    .on("barHover", function(d,i){
        var st = freqData.filter(function(s){ return s.Podcast == d[0];})[0];
        var nD = d3.keys(st.freq).map(function(s){ return {Podcast: st.Podcast, Name:st.Name, type:s, freq:st.freq[s]};});
        updatePIE(nD);
        updateLEG(nD);
    })
    .on("barNHover", function(d,i){
        $("#Comment p").empty();
        $("#Comment p").html("In general, respondents suggested as more useful: <b>Codenewbie, JSJabber and Changelog</b>.<br>They differed in their individual preference according to time programming though.</br>");
        updatePIE(tF);
        updateLEG(tF);
    })

pie
    .on("pieHover", function(d,i){
        var fD = freqData.map(function(v){return [v.Podcast, v.freq[d.data.type], v.Name];});
        var color = segColor(d.data.type);
        //console.log(d.data.type);
        $("#Comment p").empty();
        if (d.data.type == "low") {
          $("#Comment p").html("When starting programming, many considered useful <b>Codenewbie and JSJabber</b>.");
        }else if (d.data.type == "mid") {
          $("#Comment p").html("Those with more than 3 months coding started to enjoy more from more advanced, specific podcast like <b>ShopTalk, RubyRogues and DeveloperTea</b>.");
        }else{
          $("#Comment p").html("After a year, users gave less relevance to Codenewbie over the rest and started to mention more frequently <b>Changelog, SEdaily, Hanselminutes, or DotNetRocks</b>.");
        };
        updateBAR(fD, color);

    })
    .on("pieNHover", function(d,i){
        $("#Comment p").empty();
        $("#Comment p").html("In general, respondents suggested as more useful: <b>Codenewbie, JSJabber and Changelog</b>.<br>They differed in their individual preference according to time programming though.</br>");
        updateBAR(sF, "steelblue");
    })





//////////////////////////////////
// Updating area
/////////////////////////////////


updateBAR(sF);

updatePIE(tF);

updateLEG(tF);

</script>
